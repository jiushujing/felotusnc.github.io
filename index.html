<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Felotus</title>
    <link rel="stylesheet" href="style.css">
    <!-- 引入 Font Awesome 图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- [新增] 引入 Cropper.js 的 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
</head>
<body>

    <div class="app-container">
        <!-- 状态栏 -->
        <div class="status-bar">
            <span id="status-bar-time">16:15</span>
            <div class="status-bar-icons-right">
                <!-- ==================== 新增: 模型监听钥匙 ==================== -->
                <i id="model-status-key" class="fa-solid fa-key" style="display: none;"></i>
                <div id="battery-capsule" class="battery-capsule">
                    <div id="battery-capsule-liquid" class="battery-liquid"></div>
                    <span id="battery-capsule-level" class="battery-level-text">--</span>
                </div>
            </div>
        </div>

        <!-- 侧边栏菜单 -->
        <div class="sidebar-menu">
            <div class="sidebar-background"></div>
            <div class="sidebar-content">
                <div class="sidebar-top-actions">
                    <button class="action-btn"><i class="fa-solid fa-calendar-day"></i> 纪念日</button>
                    <button class="action-btn">
                        <i class="fa-solid fa-arrows-rotate"></i> 切换人设
                    </button>
                    <button class="action-btn" id="close-sidebar-btn"><i class="fa-solid fa-xmark"></i></button>
                </div>
                
                <div class="sidebar-profile-card" id="sidebar-profile-link"> 
                    <div class="profile-info">
                        <img src="https://i.imgur.com/Jz9v5aB.png" alt="avatar" class="avatar">
                        <div class="profile-details">
                            <div class="profile-name">用户</div>
                            <div class="profile-status">我的心是旷野的鸟，在你的眼…</div>
                        </div>
                        <i class="fa-solid fa-chevron-right"></i>
                    </div>
                </div>

                <div class="sidebar-nav-list">
                    <a href="#" class="nav-item" id="sidebar-api-link"><i class="fa-solid fa-plug"></i><span>API</span><i class="fa-solid fa-chevron-right"></i></a>
    
                    <!-- ==================== 新增: 注入条目 ==================== -->
                    <a href="#" class="nav-item"><i class="fa-solid fa-magic-wand-sparkles"></i><span>注入</span><i class="fa-solid fa-chevron-right"></i></a>
    
                    <a href="#" class="nav-item"><i class="fa-solid fa-star"></i><span>收藏</span><i class="fa-solid fa-chevron-right"></i></a>
                    <a href="#" class="nav-item"><i class="fa-solid fa-palette"></i><span>美化</span><i class="fa-solid fa-chevron-right"></i></a>
                    <a href="#" class="nav-item"><i class="fa-solid fa-wallet"></i><span>钱包</span><i class="fa-solid fa-chevron-right"></i></a>
                    <a href="#" class="nav-item"><i class="fa-solid fa-gem"></i><span>特殊</span><i class="fa-solid fa-chevron-right"></i></a>
                    <a href="#" class="nav-item" id="sidebar-data-link"><i class="fa-solid fa-download"></i><span>数据</span><i class="fa-solid fa-chevron-right"></i></a>
                </div>

                <div class="sidebar-bottom-actions">
                    <button><i class="fa-solid fa-gear"></i><span>设置</span></button>
                    <button id="btn-open-weather-modal"><i class="fa-solid fa-cloud"></i><span>天气</span></button>
                    <button id="btn-open-location-modal"><i class="fa-solid fa-location-dot"></i><span>定位</span></button>
                </div>
            </div>
        </div>
        
        <!-- 遮罩层 -->
        <div class="sidebar-overlay"></div>

        <!-- 主体内容包裹器 -->
        <div class="main-content-wrapper">
            <!-- 页面内容区域 -->
            <main class="main-content">
                <!-- 消息页面 -->
                <div id="page-messages" class="page active">
                    <header class="page-header">
                        <div class="user-info">
                            <img src="https://i.imgur.com/uG2g8xX.png" alt="avatar" class="avatar js-open-sidebar">
                            <div class="user-details-header">
                                <div class="header-username">用户</div>
                                <div class="header-status" id="header-status-trigger">
                                    <span id="header-status-text">在线</span>
                                </div>
                            </div>
                        </div>
                        <div class="header-actions">
                            <i class="fa-solid fa-plus" id="header-plus-btn"></i>
                        </div>

                        <!-- 头部弹出菜单 -->
                        <div class="popover-menu" id="header-popover-menu">
                            <div class="popover-item" id="btn-create-character">
                                <i class="fa-solid fa-user-plus"></i>
                                <span>创建角色</span>
                            </div>
                            <div class="popover-item">
                                <i class="fa-solid fa-users"></i>
                                <span>创建群聊</span>
                            </div>
                            <div class="popover-item">
                                <i class="fa-solid fa-check-double"></i>
                                <span>一键多选</span>
                            </div>
                        </div>
                    </header>
                    <div class="search-bar messages-search-bar">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <span>搜索</span>
                    </div>
                    <!-- [修改] 清空 chat-list，由 JS 动态填充 -->
                    <div class="chat-list">
                        <!-- 动态内容将在这里生成 -->
                    </div>
                </div>

                <!-- 角色页面 -->
                <div id="page-contacts" class="page">
                    <header class="page-header"><div class="page-title js-open-sidebar">角色</div><div class="header-actions"><i class="fa-solid fa-ellipsis-vertical"></i></div></header>
                    <div class="search-bar contacts-search-bar"><i class="fa-solid fa-magnifying-glass"></i><span>搜索</span></div>
                    <div class="contact-groups">
                        <div class="group-item new-friend-group-item"><div class="group-header new-friend-item"><div>新朋友</div><i class="fa-solid fa-chevron-right"></i></div></div>
                        <div class="contact-tabs"><button class="contact-tab-btn active" data-target="tab-content-groups">分组</button><button class="contact-tab-btn" data-target="tab-content-group-chats">群聊</button></div>
                        <div class="tab-content-wrapper">
                            <div id="tab-content-groups" class="contact-tab-content active">
                                <div class="group-item">
                                    <div class="group-header">
                                        <div><i class="fa-solid fa-chevron-right"></i> <span class="group-name">特别关心</span></div>
                                        <span class="group-count">0</span>
                                    </div>
                                </div>
                                <div class="group-item">
                                    <div class="group-header">
                                        <div><i class="fa-solid fa-chevron-right"></i> <span class="group-name">默认分组</span></div>
                                        <!-- [修改] 为数量span添加ID -->
                                        <span class="group-count" id="default-group-count">0</span>
                                    </div>
                                    <!-- [新增] 为默认分组下的角色列表添加容器 -->
                                    <div class="contact-list" id="default-group-contacts">
                                        <!-- 角色列表将在这里动态生成 -->
                                    </div>
                                </div>
                            </div>
                            <div id="tab-content-group-chats" class="contact-tab-content">
                                <div class="group-item"><div class="group-header"><div><i class="fa-solid fa-chevron-right"></i> <span class="group-name">我创建的群聊</span></div><span class="group-count">1</span></div></div>
                                <div class="group-item"><div class="group-header"><div><i class="fa-solid fa-chevron-right"></i> <span class="group-name">我加入的群聊</span></div><span class="group-count">1</span></div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 组件页面 -->
                <div id="page-tools" class="page">
                    <header class="page-header"><div class="page-title js-open-sidebar">组件</div></header>
                    <div class="tools-page-content">
                        <div class="tool-category">
                            <h3 class="tool-category-title">功能类</h3>
                            <div class="actions-grid"><div class="action-item"><i class="fa-solid fa-book-open"></i><span>小说</span></div><div class="action-item"><i class="fa-solid fa-music"></i><span>音乐</span></div><div class="action-item"><i class="fa-solid fa-book-journal-whills"></i><span>日记</span></div><div class="action-item"><i class="fa-solid fa-users-line"></i><span>菲洛图论坛</span></div><div class="action-item"><i class="fa-solid fa-hourglass-half"></i><span>专注陪伴</span></div><div class="action-item"><i class="fa-solid fa-map-pin"></i><span>记忆点</span></div></div>
                        </div>
                        <div class="tool-category">
                            <h3 class="tool-category-title">休闲类</h3>
                            <div class="actions-grid"><div class="action-item"><i class="fa-solid fa-egg"></i><span>扭蛋</span></div><div class="action-item"><i class="fa-solid fa-leaf"></i><span>农场</span></div><div class="action-item"><i class="fa-solid fa-paw"></i><span>宠物</span></div><div class="action-item"><i class="fa-solid fa-utensils"></i><span>烹饪</span></div></div>
                        </div>
                        <div class="tool-category">
                            <h3 class="tool-category-title">桌游类</h3>
                            <div class="actions-grid"><div class="action-item"><i class="fa-solid fa-user-secret"></i><span>谁是卧底</span></div><div class="action-item"><i class="fa-solid fa-moon"></i><span>狼人杀</span></div><div class="action-item"><i class="fa-solid fa-comments"></i><span>真心话</span></div><div class="action-item"><i class="fa-solid fa-plane"></i><span>飞行棋</span></div></div>
                        </div>
                    </div>
                </div>

                <!-- 长生树页面 -->
                <div id="page-tree" class="page">
                    <header class="page-header"><div class="page-title js-open-sidebar">长生树</div></header>
                    <div class="tree-container"><i class="fa-solid fa-tree"></i><p>长生树正在茁壮成长...</p></div>
                </div>

                <!-- 动态页面 -->
                <div id="page-feed" class="page">
                    <header class="page-header"><div class="page-title js-open-sidebar">动态</div><div class="header-actions"><i class="fa-solid fa-gear"></i></div></header>
                    <div class="feed-content">
                        <div class="feed-profile-banner"><img src="https://picsum.photos/seed/user1/50/50" alt="avatar" class="avatar"><div class="feed-user-info"><span>用户</span></div><i class="fa-solid fa-chevron-right"></i></div>
                        <div class="actions-grid"><div class="action-item"><i class="fa-solid fa-image"></i><span>相册</span></div><div class="action-item"><i class="fa-solid fa-comment-dots"></i><span>说说</span></div><div class="action-item"><i class="fa-solid fa-grip"></i><span>更多</span></div></div>
                        <div class="feed-card"><div class="feed-card-header"><img src="https://picsum.photos/seed/user5/100/100" alt="avatar"><div class="author-info"><div class="author-name">测试</div><div class="post-time">今天 12:00</div></div><i class="fa-solid fa-ellipsis"></i></div><div class="feed-card-body"><p>这是一条测试帖子</p><div class="shared-content">测试转发内容样式，功能还没做</div></div></div>
                    </div>
                </div>
            </main>

            <!-- 底部导航栏 -->
            <nav class="bottom-nav">
                <button class="nav-button active" data-target="page-messages"><i class="fa-solid fa-comment-dots"></i></button>
                <button class="nav-button" data-target="page-contacts"><i class="fa-solid fa-address-book"></i></button>
                <button class="nav-button" data-target="page-tree"><i class="fa-solid fa-tree"></i></button>
                <button class="nav-button" data-target="page-tools"><i class="fa-solid fa-toolbox"></i></button>
                <button class="nav-button" data-target="page-feed"><i class="fa-solid fa-star"></i></button>
            </nav>
        </div> <!-- End of main-content-wrapper -->

        <!-- 用户设置页面层 -->
        <div id="page-user-settings" class="page-overlay">
            <header class="user-settings-header">
                <i id="user-settings-back-btn" class="fa-solid fa-chevron-left"></i>
                <span>用户设置</span>
                <i id="user-settings-save-btn" class="fa-solid fa-floppy-disk"></i>
            </header>
            <div class="user-settings-content">
                <div class="user-settings-tags">
                    <span class="tag">用户</span>
                    <span class="tag add-tag">添加设定 +</span>
                </div>
                
                <div class="settings-card profile-edit-card">
                    <img src="https://i.imgur.com/uG2g8xX.png" alt="avatar" class="profile-avatar">
                    <div class="profile-details-inputs">
                        <div class="input-row">
                            <label>姓名</label>
                            <input type="text" id="input-name" placeholder="你的名字">
                        </div>
                        <div class="input-row">
                            <label>性别</label>
                            <input type="text" id="input-gender" value="女">
                        </div>
                        <div class="input-row">
                            <label>生日</label>
                            <input type="text" placeholder="例如1.1" id="input-birthday">
                        </div>
                        <div class="input-row">
                            <label>年龄</label>
                            <input type="text" placeholder="例如20" id="input-age">
                        </div>
                    </div>
                </div>

                <div class="settings-card">
                    <div class="settings-card-header">
                        <div><i class="fa-solid fa-user"></i> 我的设定</div>
                        <i class="fa-solid fa-expand"></i>
                    </div>
                    <div class="settings-card-body">
                        <textarea placeholder="此处填写设定" id="textarea-settings"></textarea>
                    </div>
                </div>
                <div class="settings-card">
                    <div class="settings-card-header">
                        <div><i class="fa-solid fa-pen-to-square"></i> 我的个性签名</div>
                    </div>
                    <div class="settings-card-body">
                        <input type="text" placeholder="此处填写个性签名" id="input-signature">
                    </div>
                </div>
                <div class="settings-nav-group">
                    <a href="#" class="settings-nav-item">
                        <div><i class="fa-solid fa-star"></i> 我的空间</div>
                        <i class="fa-solid fa-chevron-right"></i>
                    </a>
                    <a href="#" class="settings-nav-item">
                        <div><i class="fa-solid fa-gift"></i> 我的礼物墙</div>
                        <i class="fa-solid fa-chevron-right"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- ==================== 新增: 角色设置页面层 ==================== -->
        <div id="page-character-settings" class="page-overlay">
            <header class="user-settings-header">
                <i id="character-settings-back-btn" class="fa-solid fa-chevron-left"></i>
                <span>角色设置</span>
                <i id="character-settings-save-btn" class="fa-solid fa-floppy-disk"></i>
            </header>
            <div class="user-settings-content">
                
                <div class="settings-card profile-edit-card">
                    <!-- [修改] 给 img 标签添加 id -->
                    <img src="https://i.imgur.com/Jz9v5aB.png" alt="avatar" class="profile-avatar" id="char-avatar-preview">
                    <!-- [新增] 隐藏的文件上传输入框 -->
                    <input type="file" id="char-avatar-input" accept="image/*" style="display: none;">

                    <div class="profile-details-inputs">
                        <div class="input-row">
                            <label>姓名</label>
                            <input type="text" id="input-char-name" placeholder="角色名字">
                        </div>
                        <div class="input-row">
                            <label>性别</label>
                            <input type="text" id="input-char-gender" placeholder="女/男/无">
                        </div>
                        <div class="input-row">
                            <label>生日</label>
                            <input type="text" placeholder="例如1.1" id="input-char-birthday">
                        </div>
                        <div class="input-row">
                            <label>年龄</label>
                            <input type="text" placeholder="例如20" id="input-char-age">
                        </div>
                    </div>
                </div>

                <div class="settings-card">
                    <div class="settings-card-header">
                        <div><i class="fa-solid fa-user"></i> 角色设定</div>
                        <i class="fa-solid fa-expand"></i>
                    </div>
                    <div class="settings-card-body">
                        <textarea placeholder="此处填写角色设定" id="textarea-char-settings"></textarea>
                    </div>
                </div>
                <div class="settings-card">
                    <div class="settings-card-header">
                        <div><i class="fa-solid fa-pen-to-square"></i> 角色个性签名</div>
                    </div>
                    <div class="settings-card-body">
                        <span class="placeholder-text">和角色聊点什么后再来看看吧</span>
                    </div>
                </div>
                <div class="settings-nav-group">
                    <a href="#" class="settings-nav-item">
                        <div><i class="fa-solid fa-star"></i> 角色空间</div>
                        <i class="fa-solid fa-chevron-right"></i>
                    </a>
                    <a href="#" class="settings-nav-item">
                        <div><i class="fa-solid fa-gift"></i> 角色礼物墙</div>
                        <i class="fa-solid fa-chevron-right"></i>
                    </a>
                </div>
            </div>
        </div>
        <!-- ==================== 角色设置页面层结束 ==================== -->


        <!-- 数据管理页面 -->
        <div id="page-data-management" class="page-overlay">
            <header class="user-settings-header">
                <i id="data-management-back-btn" class="fa-solid fa-chevron-left"></i>
                <span>数据管理</span>
                <i></i> <!-- 占位符 -->
            </header>
            <div class="user-settings-content">
                <div class="data-actions-list">
                    <button id="btn-export-data" class="data-action-item">
                        <i class="fa-solid fa-file-export"></i>
                        <span>导出本地数据</span>
                    </button>
                    <button id="btn-import-data" class="data-action-item">
                        <i class="fa-solid fa-file-import"></i>
                        <span>导入本地数据</span>
                    </button>
                    <button id="btn-upload-cloud" class="data-action-item disabled">
                        <i class="fa-solid fa-cloud-arrow-up"></i>
                        <span>上传云端数据</span>
                    </button>
                    <!-- [新增] 清除本地数据按钮 -->
                    <button id="btn-clear-data" class="data-action-item danger">
                        <i class="fa-solid fa-trash-can"></i>
                        <span>清除本地数据</span>
                    </button>
                    <input type="file" id="import-file-input" accept=".json" style="display: none;">
                </div>
            </div>
        </div>

        <!-- ==================== API 管理页面层 (V2.0 重构版) ==================== -->
        <div id="page-api-settings" class="page-overlay">
            <header class="user-settings-header">
                <i id="api-settings-back-btn" class="fa-solid fa-chevron-left"></i>
                <span>API 管理</span>
                <i></i> <!-- 占位符 -->
            </header>
            <div class="user-settings-content">
                <form id="api-settings-form">
                    
                    <div class="form-group">
                        <label for="api-config-select">选择配置 (可切换)</label>
                        <select id="api-config-select">
                            <!-- 配置将由JS动态生成 -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="api-type-select">选择格式 (必选)</label>
                        <select id="api-type-select">
                            <option value="openai">兼容OpenAI</option>
                            <option value="gemini">Gemini Key</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="api-url">API 地址 (Base URL)</label>
                        <input type="text" id="api-url" placeholder="格式参考 https://example.com">
                    </div>
                    <div class="form-group">
                        <label for="api-key">密钥 (API Key)</label>
                        <input type="password" id="api-key" placeholder="请输入API Key">
                    </div>
                    <div class="form-group">
                        <label for="model-select">选择模型</label>
                        <select id="model-select">
                            <optgroup id="openai-models" label="OpenAI / 兼容"></optgroup>
                            <optgroup id="gemini-models" label="Google Gemini"></optgroup>
                        </select>
                    </div>

                    <div class="api-actions-grid">
                        <button type="button" id="btn-new-config" class="action-button">新建配置</button>
                        <button type="button" id="fetch-models-button-new" class="action-button">拉取模型</button>
                        <button type="button" id="btn-delete-config" class="action-button">删除配置</button>
                        <button type="submit" id="btn-save-config" class="action-button">保存配置</button>
                    </div>

                </form>
            </div>
        </div>
        <!-- ==================== API 管理页面层结束 ==================== -->

        <!-- 天气、定位、状态模态框 -->
<div class="modal-overlay-container" id="modal-container">
    <!-- 天气模态框 -->
    <div class="modal-panel" id="weather-modal">
        <div class="modal-header">
            <h3>选择天气</h3>
            <button class="modal-close-btn"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-content">
            <div class="weather-grid" id="weather-options-grid">
                <!-- 天气选项将由 JS 动态生成 -->
            </div>
        </div>
    </div>
    
    <!-- 定位模态框 -->
    <div class="modal-panel" id="location-modal">
        <div class="modal-header">
            <h3>管理定位</h3>
            <button class="modal-close-btn"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-content" id="location-cards-container">
            <!-- 定位卡片将由 JS 动态生成 -->
        </div>
        <div class="modal-footer">
            <button class="modal-action-btn" id="btn-add-location">
                <i class="fa-solid fa-plus"></i> 添加新定位
            </button>
        </div>
    </div>

    <!-- 状态模态框 -->
    <div class="modal-panel" id="status-modal">
        <div class="modal-header">
            <h3>选择状态</h3>
            <button class="modal-close-btn"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-content">
            <div class="status-grid" id="status-options-grid">
                <!-- 状态选项将由 JS 动态生成 -->
            </div>
        </div>
    </div>
    
    <!-- [修复] 将清除数据模态框移入容器内 -->
    <div class="modal-panel" id="clear-data-modal">
        <div class="modal-header">
            <h3>确认清除数据</h3>
            <button class="modal-close-btn"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-content">
            <p>此操作不可逆！将清除所有用户、角色、API及其他设置。</p>
            <p>请输入 <strong>delete</strong> 以确认：</p>
            <input type="text" id="clear-data-confirm-input" class="clear-data-input" autocomplete="off">
        </div>
        <div class="modal-footer">
            <button class="modal-action-btn danger" id="confirm-clear-data-btn" disabled>
                确认清除
            </button>
        </div>
    </div>

</div>

    <script src="script.js"></script>
    <!-- [新增] 引入 Cropper.js 的 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
</body>
</html>